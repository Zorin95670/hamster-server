import{r as v,w as T,o as S,l as s,m as k,n as c,j as o,aj as y,F as $,al as V,Q as x,Z as D,_ as A,a as P}from"./index.187af2f5.js";import{_ as H,b as Q,c as N,Q as q}from"./TagChip.471f05d9.js";import{Q as I}from"./QPage.3c61cbd4.js";import{Q as h,a as M}from"./QTable.23a2a766.js";import{D as E,f as O,u as B}from"./ActivityService.1d85595f.js";import{h as b,_ as j}from"./TagSelect.85d0a12d.js";import{E as C}from"./QList.158cf0bc.js";import"./scroll.74f98dda.js";import"./format.865294d5.js";import"./plugin-vue_export-helper.21dcd24c.js";const F={key:1},R={key:1},J={__name:"ActivityTable",props:{activities:{type:Array,required:!0}},emits:["save","stop","remove"],setup(w){const i=w,u=v({}),m=v({}),r=v([{name:"name",field:"name",label:"Activity name",align:"left"},{name:"tags",field:"tags",label:"Tags",align:"left"},{name:"startDate",field:"startDate",label:"Start date",align:"left"},{name:"endDate",field:"endDate",label:"End date",align:"left"},{name:"actions",field:"id",label:"Actions",align:"left"}]);function f(){u.value={},i.activities.forEach(({id:n,startDate:p,endDate:e})=>{u.value[n]=p,m.value[n]=e})}function _(n,p,e){const t=i.activities.find(({id:a})=>a===n);t[p]=e}return T(()=>i.activities,f),S(()=>{f()}),(n,p)=>(s(),k(M,{columns:r.value,rows:w.activities},{"body-cell-tags":c(e=>[o(h,{key:"tags",props:e},{default:c(()=>[(s(!0),y($,null,V(e.row.tags,t=>(s(),k(H,{key:`${e.row.id}_${t.id}`,tag:t},null,8,["tag"]))),128))]),_:2},1032,["props"])]),"body-cell-startDate":c(e=>[o(h,{key:"startDate",props:e},{default:c(()=>[u.value[e.row.id]?(s(),k(E,{key:0,modelValue:u.value[e.row.id],"onUpdate:modelValue":[t=>u.value[e.row.id]=t,t=>_(e.row.id,"startDate",t)]},null,8,["modelValue","onUpdate:modelValue"])):(s(),y("span",F,"-"))]),_:2},1032,["props"])]),"body-cell-endDate":c(e=>[o(h,{key:"endDate",props:e},{default:c(()=>[m.value[e.row.id]?(s(),k(E,{key:0,modelValue:m.value[e.row.id],"onUpdate:modelValue":[t=>m.value[e.row.id]=t,t=>_(e.row.id,"endDate",t)]},null,8,["modelValue","onUpdate:modelValue"])):(s(),y("span",R,"-"))]),_:2},1032,["props"])]),"body-cell-actions":c(e=>[o(h,{key:"actions",props:e},{default:c(()=>[o(x,{dense:"",flat:"",rounded:"",color:"positive",icon:"save",class:"q-mr-sm",onClick:t=>n.$emit("save",e.row.id)},null,8,["onClick"]),o(x,{dense:"",flat:"",rounded:"",color:"negative",icon:"stop",onClick:t=>n.$emit("stop",e.row.id)},null,8,["onClick"]),o(x,{dense:"",flat:"",rounded:"",color:"black",icon:"delete",onClick:t=>n.$emit("remove",e.row.id)},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["columns","rows"]))}},X={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1460 120"},z=["id","x","width"],L=["x"],Z=["x1","x2"],G=["x"],K={__name:"DayTrackingImage",props:{modelValue:{type:Array,default:()=>[]}},setup(w){const i=w,u=v([]),m=v(Array(25).fill(0).map((e,t)=>t));function r(e){const t=b(e||Date.now());return t.hours()*60+t.minutes()}const f=v(Date.now()),_=v(r(new Date)),n=v(new Date().getMinutes());function p(){const e=b().startOf("day");u.value=JSON.parse(JSON.stringify(i.modelValue)).filter(({endDate:t})=>!t||b(t).isSame(e,"d")).map(t=>(b(t.startDate).isSame(e,"d")||(t.startDate=e.valueOf()),t))}return T(()=>i.modelValue,p),S(()=>{p(),setInterval(()=>{const e=new Date;f.value=Date.now();const t=r(e);t!==_.value&&(_.value=t,n.value=e.getMinutes())},1e3)}),(e,t)=>(s(),y("svg",X,[(s(!0),y($,null,V(u.value,a=>(s(),y("rect",{id:`time-${a.id}`,key:a.id,x:r(a.startDate,a.id)+10,y:"0",width:r(a.endDate||f.value)-r(a.startDate),height:"100",fill:"teal"},[D("title",null,A(a.name),1)],8,z))),128)),D("rect",{x:r(f.value)+9,y:"0",width:3,height:"100",fill:"red"},null,8,L),(s(!0),y($,null,V(m.value,a=>(s(),y("line",{key:`h${a}-line`,x1:a*60+10,y1:"0",x2:a*60+10,y2:"100",stroke:"black","stroke-width":"1","stroke-dasharray":"5,5"},null,8,Z))),128)),(s(!0),y($,null,V(m.value,a=>(s(),y("text",{key:`h${a}-text`,x:a*60+10,y:"115","text-anchor":"middle","font-size":"10",fill:"black"},A(a)+"h ",9,G))),128))]))}},W={class:"flex q-mb-md"},Y={class:"text-h6"},de={__name:"HomePage",setup(w){const i=v([]),u=v(!0),m=v(null),r=v([]),f={};let _;function n(){u.value=!0,O(f).then(l=>{i.value=l.data.content}).catch(l=>console.log("error",l)).finally(()=>{u.value=!1})}function p(){f.name=m.value.length>0?`lk_*${m.value}*`:null,f.tags=r.value.length>0?`lk_*${r.value.map(({id:l})=>l).join(",")}*`:null,n()}function e(){C.DialogEvent.next({key:"add-activity",type:"open",last:i.value.find(({endDate:l})=>!l)})}function t(l){C.DialogEvent.next({key:"remove-activity",type:"open",activity:i.value.find(({id:d})=>d===l)})}async function a(l){u.value=!0;const d=i.value.find(({id:g})=>g===l);await B(d),n()}async function U(l){const d=i.value.find(({id:g})=>g===l);d.endDate=Date.now(),await B(d),n()}return S(()=>{_=C.ReloadActivitiesEvent.subscribe(n),n()}),P(()=>{_.unsubscribe()}),(l,d)=>(s(),k(I,{class:"flex column items-start"},{default:c(()=>[o(K,{modelValue:i.value,"onUpdate:modelValue":d[0]||(d[0]=g=>i.value=g),class:"q-mt-md"},null,8,["modelValue"]),D("h3",null,A(l.$t("HomePage.title")),1),D("div",W,[o(x,{outline:"",label:l.$t("HomePage.startActivity"),color:"primary",onClick:e},null,8,["label"])]),o(q,{class:"flex row items-center q-mb-md"},{default:c(()=>[o(Q,null,{default:c(()=>[D("div",Y,A(l.$t("HomePage.filters")),1)]),_:1}),o(Q,null,{default:c(()=>[o(N,{outlined:"",label:l.$t("HomePage.filterByName"),modelValue:m.value,"onUpdate:modelValue":[d[1]||(d[1]=g=>m.value=g),p]},null,8,["label","modelValue"])]),_:1}),o(Q,null,{default:c(()=>[o(j,{outlined:"",label:l.$t("HomePage.filterByTag"),modelValue:r.value,"onUpdate:modelValue":[d[2]||(d[2]=g=>r.value=g),p]},null,8,["label","modelValue"])]),_:1})]),_:1}),o(J,{activities:i.value,loading:u.value,onSave:a,onStop:U,onRemove:t},null,8,["activities","loading"])]),_:1}))}};export{de as default};
